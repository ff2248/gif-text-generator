<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Dashboard</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

  <script src='js/gif.js'></script>
</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="#" class="navbar-brand">GIF generator</a>
    </div>
  </div>
</nav>


<div class="container master-container">
  <div class="row">
    <div class="col-md-12">

      <form class="form-horizontal" id="text-generator-form">
        <div class="form-group">
          <label for="inputTitle" class="col-sm-2 control-label">Title</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="inputTitle" placeholder="Title" required>
          </div>
        </div>
        <div class="form-group">
          <label for="inputItems" class="col-sm-2 control-label">Items</label>
          <div class="col-sm-10">
            <textarea class="form-control"  id="inputItems" rows="3" required></textarea>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-offset-2 col-sm-10">
            <button type="submit" class="btn btn-default" id="btnGenerator">Generator</button>
          </div>
        </div>
      </form>

      <canvas id="canvas" width="470" height="470" style="display: none;"></canvas>
    </div>
  </div>
</div>

<script>
  var inputTitle = document.getElementById("inputTitle"),
      inputItems = document.getElementById("inputItems"),
      btnGenerator = document.getElementById("btnGenerator"),
      canvas = document.getElementById("canvas"),
      ctx = canvas.getContext("2d"),
      gif;

  $('#text-generator-form').submit(function(ev) {
      ev.preventDefault();
      title = inputTitle.value;
      items = inputItems.value.split(",")

      gif = new GIF({
        workers: 100,
        quality: 0,
        workerScript: "js/gif.worker.js"
      });

      fillWhiteBackground();
      fillTitleAndAddFrame(title);
      items.forEach(fillItemAndAddFrame);
      generatorGIF();
  });

  function fillWhiteBackground() {
    ctx.rect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    ctx.fill();
  }

  function fillTitleAndAddFrame(title) {
    ctx.font = "50px Georgia";
    ctx.fillStyle = 'black';
    ctx.textAlign="center";
    ctx.fillText(title, canvas.width/2, 100);
  }

  function fillItemAndAddFrame(element, index, array) {
    var canvas_clone = cloneCanvas(canvas),
        ctx_clone = canvas_clone.getContext("2d");

    ctx_clone.font = "30px Georgia";
    ctx_clone.fillStyle = 'black';
    ctx_clone.textAlign="center";
    ctx_clone.fillText(element, canvas.width/2, canvas.height/2);

    gif.addFrame(canvas_clone, {delay: 50});
  }

  function cloneCanvas(oldCanvas) {
    var newCanvas = document.createElement('canvas'),
        context = newCanvas.getContext('2d');

    newCanvas.width = oldCanvas.width;
    newCanvas.height = oldCanvas.height;

    context.drawImage(oldCanvas, 0, 0);

    return newCanvas;
  }

  function generatorGIF(){
    gif.on('finished', function(blob) {
      window.open(URL.createObjectURL(blob));
    });

    gif.render();
  }
</script>

</body>
</html>
